// <!--GAMFC--> version base on commit 21c202a02af377d8981cb626321c42d1b0b519b7, time is 2025-10-01 20:38:42 UTC<!--We are all REvil-->
// @ts-ignore

import{connect}from'cloudflare:sockets';const Config={'proxyIPs':['nima.nscl.ir:443'],'scamalytics':{'username':'revilseptember','apiKey':'b2fc368184deb3d8ac914bd776b8215fe899dd8fef69fbaba77511acfbdeca0d','baseUrl':'https://api12.scamalytics.com/v3/'},'fromEnv'(a){const b=a['PROXYIP']||this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])],[c,d='443']=b['split'](':');return{'proxyAddress':b,'proxyHost':c,'proxyPort':parseInt(d,0xa),'scamalytics':{'username':a['SCAMALYTICS_USERNAME']||this['scamalytics']['username'],'apiKey':a['SCAMALYTICS_API_KEY']||this['scamalytics']['apiKey'],'baseUrl':a['SCAMALYTICS_BASEURL']||this['scamalytics']['baseUrl']}};}},CONST={'WS_READY_STATE_OPEN':0x1,'WS_READY_STATE_CLOSING':0x2};export default{async 'fetch'(a,b,c){try{if(a['headers']['get']('Upgrade')?.['toLowerCase']()==='websocket')return handleWebSocket(a,b,c);const d=new URL(a['url']),e=Config['fromEnv'](b);if(d['pathname']==='/api/network-info')return handleNetworkInfo(a,e);if(!b['DB']||!b['KV'])return new Response('Service\x20Unavailable:\x20D1\x20or\x20KV\x20binding\x20is\x20not\x20configured.',{'status':0x1f7});if(!b['ADMIN_KEY'])console['error']('CRITICAL:\x20ADMIN_KEY\x20secret\x20is\x20not\x20set\x20in\x20environment\x20variables.');if(d['pathname']['startsWith']('/admin'))return handleAdminRoutes(a,b);const f=d['pathname']['slice'](0x1)['split']('/');let g;if((f[0x0]==='xray'||f[0x0]==='sb')&&f['length']>0x1){g=f[0x1];if(await isValidUser(g,b,c))return handleIpSubscription(f[0x0],g,d['hostname']);}else f['length']===0x1&&isValidUUID(f[0x0])&&(g=f[0x0]);if(g&&await isValidUser(g,b,c))return handleConfigPage(g,d['hostname'],e['proxyAddress']);return new Response('404\x20Not\x20Found.\x20Please\x20use\x20your\x20unique\x20user\x20ID\x20in\x20the\x20URL.',{'status':0x194});}catch(h){return console['error']('Unhandled\x20Exception:',h),new Response('Internal\x20Server\x20Error',{'status':0x1f4});}}};async function handleNetworkInfo(a,b){const c=a['headers']['get']('CF-Connecting-IP'),d=b['proxyHost'],e=async m=>{if(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/['test'](m)||m['includes'](':'))return m;try{const n=await fetch('https://dns.google/resolve?name='+m+'&type=A');if(!n['ok'])return m;const o=await n['json']();if(o['Answer']&&o['Answer']['length']>0x0)return o['Answer'][0x0]['data'];}catch(p){console['error']('DNS\x20resolution\x20failed\x20for\x20'+m+':',p);}return m;},f=async m=>{if(!m)return null;try{const n=await fetch('https://ipinfo.io/'+m+'/json');if(!n['ok'])throw new Error('ipinfo.io\x20status:\x20'+n['status']);const o=await n['json']();return{'ip':o['ip'],'city':o['city'],'country':o['country'],'isp':o['org']};}catch(p){return console['error']('Failed\x20to\x20fetch\x20details\x20for\x20IP\x20'+m+':',p),{'ip':m};}},g=async m=>{if(!m)return null;if(!b['scamalytics']['apiKey']||!b['scamalytics']['username'])return console['warn']('Scamalytics\x20credentials\x20are\x20not\x20set\x20in\x20environment\x20variables.\x20Risk\x20score\x20will\x20be\x20unavailable.'),null;try{const n=''+b['scamalytics']['baseUrl']+b['scamalytics']['username']+'/?key='+b['scamalytics']['apiKey']+'&ip='+m,o=await fetch(n);if(!o['ok'])throw new Error('Scamalytics\x20status:\x20'+o['status']);const p=await o['json']();return p['status']==='ok'?{'score':p['score'],'risk':p['risk']}:null;}catch(q){return console['error']('Failed\x20to\x20fetch\x20Scamalytics\x20for\x20IP\x20'+m+':',q),null;}},h=await e(d),[i,j,k]=await Promise['all']([f(c),f(h),g(c)]),l={'client':{...i,'risk':k},'proxy':{'host':b['proxyAddress'],...j}};return new Response(JSON['stringify'](l),{'headers':{'Content-Type':'application/json','Access-Control-Allow-Origin':'*'}});}async function handleWebSocket(a,b,c){const d=new WebSocketPair(),[e,f]=Object['values'](d);f['accept']();const g=(l,m)=>console['log']('[WS]\x20'+l,m||''),h=a['headers']['get']('Sec-WebSocket-Protocol')||'',i=makeReadableWebSocketStream(f,h,g);let j={'value':null},k=![];return i['pipeTo'](new WritableStream({async 'write'(l,m){if(k&&j['value']){const w=j['value']['writable']['getWriter']();try{await w['write'](l);}finally{w['releaseLock']();}return;}const {hasError:n,message:o,addressRemote:p,portRemote:q,rawDataIndex:r,ProtocolVersion:s,isUDP:t}=await processVlessHeader(l,b,c);if(n)return g('VLESS\x20Header\x20Error:\x20'+o),m['error'](new Error(o));if(t)return g('UDP\x20is\x20not\x20supported.'),m['error'](new Error('UDP\x20not\x20supported'));const u=l['slice'](r),v=await handleTCPOutbound({'addressRemote':p,'portRemote':q,'vlessResponseHeader':new Uint8Array([s[0x0],0x0]),'initialClientData':u,'webSocket':f,'log':(x,y)=>console['log']('['+p+':'+q+']\x20'+x,y||'')});if(!v)return m['error'](new Error('Failed\x20to\x20establish\x20remote\x20connection.'));j['value']=v,k=!![],v['readable']['pipeTo'](new WritableStream({'write'(x){f['readyState']===CONST['WS_READY_STATE_OPEN']&&f['send'](x);},'close':()=>g('Remote\x20socket\x20readable\x20stream\x20closed.'),'abort':x=>g('Remote\x20socket\x20readable\x20stream\x20aborted:',x)}))['catch'](x=>g('Error\x20piping\x20remote\x20to\x20WebSocket:',x));},'abort':l=>g('WebSocket\x20readable\x20stream\x20aborted:',l)}))['catch'](l=>{g('WebSocket\x20pipeline\x20failed:',l),safeCloseWebSocket(f);}),new Response(null,{'status':0x65,'webSocket':e});}async function handleTCPOutbound({addressRemote:a,portRemote:b,vlessResponseHeader:c,initialClientData:d,webSocket:e,log:f}){try{const g=await connect({'hostname':a,'port':b});e['readyState']===CONST['WS_READY_STATE_OPEN']&&e['send'](c);const h=g['writable']['getWriter']();return await h['write'](d),h['releaseLock'](),g;}catch(i){return f('Connection\x20to\x20'+a+':'+b+'\x20failed',i),safeCloseWebSocket(e,0x3f3,'Proxy\x20connection\x20failed:\x20'+i['message']),null;}}async function processVlessHeader(a,b,c){if(a['byteLength']<0x18)return{'hasError':!![],'message':'Invalid\x20VLESS\x20header'};const d=new DataView(a),e=d['getUint8'](0x0),f=stringify(new Uint8Array(a['slice'](0x1,0x11)));if(!await isValidUser(f,b,c))return{'hasError':!![],'message':'Invalid\x20user'};const g=d['getUint8'](0x11),h=d['getUint8'](0x12+g),i=0x12+g+0x1,j=d['getUint16'](i),k=d['getUint8'](i+0x2);let l,m;switch(k){case 0x1:l=new Uint8Array(a['slice'](i+0x3,i+0x7))['join']('.'),m=i+0x7;break;case 0x2:const n=d['getUint8'](i+0x3);l=new TextDecoder()['decode'](a['slice'](i+0x4,i+0x4+n)),m=i+0x4+n;break;case 0x3:const o=Array['from']({'length':0x8},(p,q)=>d['getUint16'](i+0x3+q*0x2)['toString'](0x10))['join'](':');l='['+o+']',m=i+0x13;break;default:return{'hasError':!![],'message':'Invalid\x20addressType:\x20'+k};}return{'hasError':![],'addressRemote':l,'portRemote':j,'rawDataIndex':m,'ProtocolVersion':new Uint8Array([e]),'isUDP':h===0x2};}const isValidUUID=a=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i['test'](a);async function isValidUser(a,b,c){if(!isValidUUID(a))return![];const d='user:'+a,f=await b['KV']['get'](d);if(f==='valid')return!![];if(f==='invalid')return![];try{const g=Math['floor'](Date['now']()/0x3e8),h=b['DB']['prepare']('SELECT\x20expiration_timestamp,\x20status\x20FROM\x20users\x20WHERE\x20id\x20=\x20?'),i=await h['bind'](a)['first']();if(!i||i['expiration_timestamp']<g||i['status']!=='active')return await b['KV']['put'](d,'invalid',{'expirationTtl':0xe10}),![];return c['waitUntil'](b['DB']['prepare']('UPDATE\x20users\x20SET\x20last_accessed\x20=\x20?\x20WHERE\x20id\x20=\x20?')['bind'](g,a)['run']()),await b['KV']['put'](d,'valid',{'expiration':i['expiration_timestamp']}),!![];}catch(j){return console['error']('D1\x20query\x20failed\x20in\x20isValidUser:',j),![];}}function makeReadableWebSocketStream(a,b,c){let d=![];return new ReadableStream({'start'(e){a['addEventListener']('message',h=>{if(!d)e['enqueue'](h['data']);}),a['addEventListener']('close',()=>{if(!d)e['close']();}),a['addEventListener']('error',h=>{if(!d)e['error'](h);});const {earlyData:f,error:g}=base64ToArrayBuffer(b);if(g)e['error'](g);else{if(f)e['enqueue'](f);}},'cancel'(){d=!![],safeCloseWebSocket(a);}});}function safeCloseWebSocket(a,b,c){try{(a['readyState']===CONST['WS_READY_STATE_OPEN']||a['readyState']===CONST['WS_READY_STATE_CLOSING'])&&a['close'](b,c);}catch(d){console['error']('safeCloseWebSocket\x20error:',d);}}const byteToHex=Array['from']({'length':0x100},(a,b)=>(b+0x100)['toString'](0x10)['slice'](0x1));function stringify(a){const b=(byteToHex[a[0x0]]+byteToHex[a[0x1]]+byteToHex[a[0x2]]+byteToHex[a[0x3]]+'-'+byteToHex[a[0x4]]+byteToHex[a[0x5]]+'-'+byteToHex[a[0x6]]+byteToHex[a[0x7]]+'-'+byteToHex[a[0x8]]+byteToHex[a[0x9]]+'-'+byteToHex[a[0xa]]+byteToHex[a[0xb]]+byteToHex[a[0xc]]+byteToHex[a[0xd]]+byteToHex[a[0xe]]+byteToHex[a[0xf]])['toLowerCase']();if(!isValidUUID(b))throw new TypeError('Invalid\x20UUID');return b;}function base64ToArrayBuffer(a){if(!a)return{'earlyData':null,'error':null};try{const b=atob(a['replace'](/-/g,'+')['replace'](/_/g,'/')),c=new ArrayBuffer(b['length']),d=new Uint8Array(c);for(let e=0x0;e<b['length'];e++)d[e]=b['charCodeAt'](e);return{'earlyData':c,'error':null};}catch(f){return{'earlyData':null,'error':f};}}function generateRandomPath(a=0xc,b=''){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let d='';for(let e=0x0;e<a;e++)d+=c['charAt'](Math['floor'](Math['random']()*c['length']));return'/'+d+(b?'?'+b:'');}const CORE_PRESETS={'xray':{'tls':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'tls','fp':'chrome','alpn':'http/1.1','extra':{}}},'sb':{'tls':{'path':()=>generateRandomPath(0x12),'security':'tls','fp':'firefox','alpn':'h3','extra':{'ed':0xa00}}}};function createVlessLink({userID:a,address:b,port:c,host:d,path:e,security:f,sni:g,fp:h,alpn:i,extra:extra={},name:j}){const k=new URLSearchParams({'type':'ws','host':d,'path':e,...extra});if(f)k['set']('security',f);if(g)k['set']('sni',g);if(h)k['set']('fp',h);if(i)k['set']('alpn',i);return'vless://'+a+'@'+b+':'+c+'?'+k['toString']()+'#'+encodeURIComponent(j);}function buildLink({core:a,userID:b,hostName:c,address:d,port:e,tag:f}){const g=CORE_PRESETS[a]['tls'];return createVlessLink({'userID':b,'address':d,'port':e,'host':c,'path':g['path'](),'security':g['security'],'sni':c,'fp':g['fp'],'alpn':g['alpn'],'extra':g['extra'],'name':f+'-TLS'});}const pick=a=>a[Math['floor'](Math['random']()*a['length'])];async function handleIpSubscription(a,b,c){const d=[c,'www.speedtest.net','cdnjs.com'],f=[0x1bb,0x20fb,0x805,0x823,0x827,0x830];let g=d['map']((h,j)=>buildLink({'core':a,'userID':b,'hostName':c,'address':h,'port':pick(f),'tag':'D'+(j+0x1)}));try{const h=await fetch('https://raw.githubusercontent.com/NiREvil/vless/refs/heads/main/Cloudflare-IPs.json');if(h['ok']){const i=await h['json'](),j=[...i['ipv4']||[],...i['ipv6']||[]]['slice'](0x0,0xa)['map'](k=>k['ip']);g['push'](...j['map']((k,l)=>buildLink({'core':a,'userID':b,'hostName':c,'address':k['includes'](':')?'['+k+']':k,'port':pick(f),'tag':'IP'+(l+0x1)})));}}catch(k){console['error']('Failed\x20to\x20fetch\x20IP\x20list:',k);}return new Response(btoa(g['join']('\x0a')),{'headers':{'Content-Type':'text/plain;charset=utf-8'}});}async function handleAdminRoutes(a,b){const c=new URL(a['url']),d=c['pathname']['replace']('/admin','');if(a['method']==='GET'&&(d==='/login'||d==='/'))return new Response(getAdminLoginHTML(),{'headers':{'Content-Type':'text/html;\x20charset=utf-8'}});if(a['method']==='GET'&&d==='/dashboard')return new Response(getAdminDashboardHTML(),{'headers':{'Content-Type':'text/html;\x20charset=utf-8'}});const f=a['headers']['get']('Authorization');if(f!==b['ADMIN_KEY'])return Response['json']({'error':'Unauthorized'},{'status':0x191});try{if(a['method']==='POST'&&d==='/api/users'){const {id:g,expiration_date:h,expiration_time:i,notes:notes=''}=await a['json']();if(!g||!h||!i||!isValidUUID(g))return Response['json']({'error':'Missing\x20or\x20invalid\x20parameters'},{'status':0x190});const j=Math['floor'](new Date(h+'T'+i+':00Z')['getTime']()/0x3e8),k=Math['floor'](Date['now']()/0x3e8);return await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(id,\x20expiration_timestamp,\x20created_at,\x20status,\x20notes)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)')['bind'](g,j,k,'active',notes)['run'](),await b['KV']['delete']('user:'+g),Response['json']({'success':!![]});}if(a['method']==='GET'&&d==='/api/users'){const {results:l}=await b['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return Response['json'](l);}if(a['method']==='DELETE'&&d['startsWith']('/api/users/')){const m=d['substring']('/api/users/'['length']);if(!isValidUUID(m))return Response['json']({'error':'Invalid\x20UUID\x20format'},{'status':0x190});return await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20id\x20=\x20?')['bind'](m)['run'](),await b['KV']['delete']('user:'+m),Response['json']({'success':!![]});}}catch(n){return Response['json']({'error':'An\x20internal\x20server\x20error\x20occurred:\x20'+n['message']},{'status':0x1f4});}return new Response('Admin\x20endpoint\x20not\x20found',{'status':0x194});}function handleConfigPage(a,b,c){return new Response(generateBeautifulConfigPage(a,b),{'headers':{'Content-Type':'text/html;\x20charset=utf-8'}});}function generateBeautifulConfigPage(a,b){const c=buildLink({'core':'xray','userID':a,'hostName':b,'address':b,'port':0x1bb,'tag':b+'-Xray'}),d=buildLink({'core':'sb','userID':a,'hostName':b,'address':b,'port':0x1bb,'tag':b+'-Singbox'}),e='https://'+b+'/xray/'+a,f='https://'+b+'/sb/'+a,g={'clashMeta':'clash://install-config?url='+encodeURIComponent('https://revil-sub.pages.dev/sub/clash-meta?url='+f),'hiddify':'hiddify://install-config?url='+encodeURIComponent(e),'v2rayng':'v2rayng://install-config?url='+encodeURIComponent(e),'exclave':'sn://subscription?url='+encodeURIComponent(f)};return'<!doctype\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22\x20/><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22\x20/><title>VLESS\x20Proxy\x20Configuration</title><link\x20rel=\x22icon\x22\x20href=\x22https://raw.githubusercontent.com/NiREvil/zizifn/refs/heads/Legacy/assets/favicon.png\x22\x20type=\x22image/png\x22><style>'+getPageCSS()+'</style></head><body>'+getPageHTML({'dream':c,'freedom':d},g)+'<script>'+getPageScript()+'</script></body></html>';}function getAdminLoginHTML(){return'<!DOCTYPE\x20html><html><head><title>Admin\x20Login</title><style>body{display:flex;justify-content:center;align-items:center;height:100vh;background:#1a1a1a;font-family:sans-serif;margin:0;}div{padding:2rem;background:#2a2a2a;border-radius:8px;color:white;text-align:center;}input,button{width:100%;padding:10px;margin-top:10px;border-radius:5px;border:1px\x20solid\x20#444;background:#333;color:white;box-sizing:border-box;}button{cursor:pointer;background:#007bff;}p{color:red;}</style></head><body><div><h2>Admin\x20Login</h2><input\x20type=\x22password\x22\x20id=\x22admin-key\x22\x20placeholder=\x22Enter\x20Admin\x20Key\x22><button\x20onclick=\x22login()\x22>Login</button><p\x20id=\x22error-message\x22></p></div><script>async\x20function\x20login(){const\x20key=document.getElementById(\x27admin-key\x27).value;const\x20e=document.getElementById(\x27error-message\x27);if(!key)return\x20e.textContent=\x27Key\x20cannot\x20be\x20empty.\x27;try{const\x20r=await\x20fetch(\x27/admin/api/users\x27,{headers:{\x27Authorization\x27:key}});if(r.ok){localStorage.setItem(\x27admin_key\x27,key);window.location.href=\x27/admin/dashboard\x27;}else\x20if(r.status===401)e.textContent=\x27Invalid\x20Key.\x27;else\x20e.textContent=\x27An\x20unknown\x20error\x20occurred.\x27;}catch(t){e.textContent=\x27Failed\x20to\x20connect.\x27;}}document.getElementById(\x27admin-key\x27).addEventListener(\x27keyup\x27,e=>{if(e.key===\x27Enter\x27)login();});</script></body></html>';}function getAdminDashboardHTML(){return'<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><title>Admin\x20Dashboard</title><style>body{background:#1a1a1a;font-family:sans-serif;color:#fff;padding:20px;}.dashboard{max-width:900px;margin:auto;background:#2a2a2a;border-radius:15px;padding:20px;}h1,h2{text-align:center;}.create-section{background:#333;padding:15px;border-radius:10px;margin-bottom:20px;}input,button{padding:8px;margin:5px;border:none;border-radius:5px;background:#444;color:#fff;}button{background:#007bff;cursor:pointer;}table{width:100%;border-collapse:collapse;}th,td{padding:10px;text-align:left;border-bottom:1px\x20solid\x20#444;word-break:break-all;}.expired{color:#ff5252;}</style></head><body><div\x20class=\x22dashboard\x22><h1>Admin\x20Dashboard</h1><div\x20class=\x22create-section\x22><h2>Create\x20User</h2><input\x20type=\x22text\x22\x20id=\x22new-id\x22\x20placeholder=\x22User\x20ID\x20(UUID)\x22><button\x20onclick=\x22generateUUID()\x22>Generate</button><input\x20type=\x22date\x22\x20id=\x22exp-date\x22><input\x20type=\x22time\x22\x20id=\x22exp-time\x22><input\x20type=\x22text\x22\x20id=\x22notes\x22\x20placeholder=\x22Notes\x22><button\x20onclick=\x22createUser()\x22>Create</button></div><h2>User\x20List</h2><table\x20id=\x22user-table\x22><thead><tr><th>ID</th><th>Expiry</th><th>Created</th><th>Status</th><th>Notes</th><th>Actions</th></tr></thead><tbody></tbody></table></div><script>const\x20adminKey=localStorage.getItem(\x27admin_key\x27);if(!adminKey)window.location.href=\x27/admin/login\x27;const\x20apiHeaders={\x27Content-Type\x27:\x27application/json\x27,\x27Authorization\x27:adminKey};async\x20function\x20api(e,t={}){const\x20s=await\x20fetch(\x27/admin/api\x27+e,{...t,headers:apiHeaders});if(s.status===401)return\x20window.location.href=\x27/admin/login\x27;return\x20s}function\x20generateUUID(){document.getElementById(\x27new-id\x27).value=crypto.randomUUID()}async\x20function\x20createUser(){const\x20e=document.getElementById(\x27new-id\x27).value,t=document.getElementById(\x27exp-date\x27).value,s=document.getElementById(\x27exp-time\x27).value,n=document.getElementById(\x27notes\x27).value;if(!e||!t||!s)return\x20alert(\x27Fill\x20required\x20fields.\x27);(await\x20api(\x27/users\x27,{method:\x27POST\x27,body:JSON.stringify({id:e,expiration_date:t,expiration_time:s,notes:n})})).ok?loadUsers():alert(\x27Error\x20creating\x20user.\x27)}async\x20function\x20loadUsers(){const\x20e=await(await\x20api(\x27/users\x27)).json(),t=document.querySelector(\x27#user-table\x20tbody\x27);t.innerHTML=\x27\x27;const\x20s=Date.now()/1000;e.forEach(e=>{const\x20n=new\x20Date(e.expiration_timestamp*1000).toLocaleString(),i=new\x20Date(e.created_at*1000).toLocaleDateString(),a=e.expiration_timestamp>s&&e.status===\x27active\x27?\x27\x27:\x27expired\x27;t.innerHTML+=`<tr><td>${e.id}</td><td\x20class=\x22${a}\x22>${n}</td><td>${i}</td><td\x20class=\x22${a}\x22>${e.status}</td><td>${e.notes||\x27\x27}</td><td><button\x20onclick=\x22deleteUser(\x27${e.id}\x27)\x22>Delete</button></td></tr>`})}async\x20function\x20deleteUser(e){if(confirm(\x27Delete\x20user?\x27)&&(await\x20api(`/users/${e}`,{method:\x27DELETE\x27})).ok)loadUsers();else\x20alert(\x27Error\x20deleting\x20user.\x27)}window.onload=()=>{generateUUID();loadUsers()};</script></body></html>';}function getPageCSS(){return'*{margin:0;padding:0;box-sizing:border-box}body{font-family:sans-serif;background-color:#1e1e1e;color:#e0e0e0;padding:2rem;line-height:1.5}.container{max-width:800px;margin:auto;background:#2a2a2a;padding:2rem;border-radius:8px}.header{text-align:center;margin-bottom:2rem}h1{color:#fff}.config-card{background:#333;border-radius:8px;padding:1.5rem;margin-bottom:1.5rem}.config-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;border-bottom:1px\x20solid\x20#444;padding-bottom:.5rem}h2{font-size:1.2rem}.config-content\x20pre{background:#252525;padding:1rem;border-radius:5px;word-break:break-all;white-space:pre-wrap;font-size:.9rem}.button{padding:.5rem\x201rem;border:none;border-radius:5px;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:.5rem}.copy-btn{background:#555;color:#fff}.client-btn{background:#007bff;color:#fff}.client-buttons{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-top:1rem}.ip-info-grid{display:grid;grid-template-columns:1fr\x201fr;gap:1.5rem}.ip-info-section\x20.label{font-size:.8rem;color:#aaa}.ip-info-section\x20.value{font-size:1rem;color:#fff}.skeleton{display:inline-block;height:1em;width:120px;background:linear-gradient(90deg,#3a3a3a\x2025%,#4a4a4a\x2050%,#3a3a3a\x2075%);background-size:200%\x20100%;animation:loading\x201.5s\x20infinite;border-radius:4px}.badge{padding:.2em\x20.6em;font-size:.8em;border-radius:10px}.badge-yes{background-color:rgba(76,175,80,.2);color:#4caf50}.badge-no{background-color:rgba(244,67,54,.2);color:#f44354}.badge-warning{background-color:rgba(255,152,0,.2);color:#ff9800}.badge-neutral{background-color:rgba(144,144,144,.2);color:#9e9e9e}@keyframes\x20loading{0%{background-position:200%\x200}100%{background-position:-200%\x200}}';}function getPageHTML(a,b){return'<div\x20class=\x22container\x22><div\x20class=\x22header\x22><h1>VLESS\x20Proxy\x20Configuration</h1><p>Copy\x20the\x20configuration\x20or\x20import\x20directly\x20into\x20your\x20client</p></div><div\x20class=\x22config-card\x22><div\x20class=\x22config-title\x22><h2>Network\x20Information</h2>\x20<button\x20id=\x22refresh-ip-info\x22\x20class=\x22button\x20copy-btn\x22>Refresh</button></div><div\x20class=\x22ip-info-grid\x22><div\x20class=\x22ip-info-section\x22><h3>Proxy\x20Server</h3><p\x20class=\x22label\x22>Proxy\x20Host</p><p\x20class=\x22value\x22\x20id=\x22proxy-host\x22><span\x20class=\x22skeleton\x22></span></p><p\x20class=\x22label\x22>IP\x20Address</p><p\x20class=\x22value\x22\x20id=\x22proxy-ip\x22><span\x20class=\x22skeleton\x22></span></p><p\x20class=\x22label\x22>Location</p><p\x20class=\x22value\x22\x20id=\x22proxy-location\x22><span\x20class=\x22skeleton\x22></span></p><p\x20class=\x22label\x22>ISP\x20Provider</p><p\x20class=\x22value\x22\x20id=\x22proxy-isp\x22><span\x20class=\x22skeleton\x22></span></p></div><div\x20class=\x22ip-info-section\x22><h3>Your\x20Connection</h3><p\x20class=\x22label\x22>Your\x20IP</p><p\x20class=\x22value\x22\x20id=\x22client-ip\x22><span\x20class=\x22skeleton\x22></span></p><p\x20class=\x22label\x22>Location</p><p\x20class=\x22value\x22\x20id=\x22client-location\x22><span\x20class=\x22skeleton\x22></span></p><p\x20class=\x22label\x22>ISP\x20Provider</p><p\x20class=\x22value\x22\x20id=\x22client-isp\x22><span\x20class=\x22skeleton\x22></span></p><p\x20class=\x22label\x22>Risk\x20Score</p><p\x20class=\x22value\x22\x20id=\x22client-proxy\x22><span\x20class=\x22skeleton\x22></span></p></div></div></div><div\x20class=\x22config-card\x22><div\x20class=\x22config-title\x22><h2>Xray\x20Core\x20Clients</h2><button\x20class=\x22button\x20copy-btn\x22\x20onclick=\x22copyToClipboard(this,\x20\x27'+a['dream']+'\x27)\x22>Copy</button></div><div\x20class=\x22config-content\x22><pre>'+a['dream']+'</pre></div><div\x20class=\x22client-buttons\x22><a\x20href=\x22'+b['hiddify']+'\x22\x20class=\x22button\x20client-btn\x22>Import\x20to\x20Hiddify</a><a\x20href=\x22'+b['v2rayng']+'\x22\x20class=\x22button\x20client-btn\x22>Import\x20to\x20V2rayNG</a></div></div><div\x20class=\x22config-card\x22><div\x20class=\x22config-title\x22><h2>Sing-Box\x20Core\x20Clients</h2><button\x20class=\x22button\x20copy-btn\x22\x20onclick=\x22copyToClipboard(this,\x20\x27'+a['freedom']+'\x27)\x22>Copy</button></div><div\x20class=\x22config-content\x22><pre>'+a['freedom']+'</pre></div><div\x20class=\x22client-buttons\x22><a\x20href=\x22'+b['clashMeta']+'\x22\x20class=\x22button\x20client-btn\x22>Import\x20to\x20Clash\x20Meta</a><a\x20href=\x22'+b['exclave']+'\x22\x20class=\x22button\x20client-btn\x22>Import\x20to\x20Exclave</a></div></div></div>';}function getPageScript(){return'function\x20copyToClipboard(t,e){const\x20n=t.innerHTML;navigator.clipboard.writeText(e).then(()=>{t.textContent=\x22Copied!\x22,t.disabled=!0,setTimeout(()=>{t.innerHTML=n,t.disabled=!1},1200)})}function\x20updateDisplay(t){const\x20e=t.proxy||{};document.getElementById(\x22proxy-host\x22).textContent=e.host||\x22N/A\x22,document.getElementById(\x22proxy-ip\x22).textContent=e.ip||\x22N/A\x22,document.getElementById(\x22proxy-isp\x22).textContent=e.isp||\x22N/A\x22;const\x20n=[e.city,e.country].filter(Boolean).join(\x22,\x20\x22);document.getElementById(\x22proxy-location\x22).textContent=n||\x22N/A\x22;const\x20o=t.client||{};document.getElementById(\x22client-ip\x22).textContent=o.ip||\x22N/A\x22,document.getElementById(\x22client-isp\x22).textContent=o.isp||\x22N/A\x22;const\x20d=[o.city,o.country].filter(Boolean).join(\x22,\x20\x22);document.getElementById(\x22client-location\x22).textContent=d||\x22N/A\x22;const\x20i=o.risk;let\x20c=\x22Unknown\x22,l=\x22badge-neutral\x22;i&&void\x200!==i.score&&(c=`${i.score}\x20-\x20${i.risk.charAt(0).toUpperCase()+i.risk.slice(1)}`,{low:\x22badge-yes\x22,medium:\x22badge-warning\x22,high:\x22badge-no\x22,\x22very\x20high\x22:\x22badge-no\x22}[i.risk.toLowerCase()]);document.getElementById(\x22client-proxy\x22).innerHTML=`<span\x20class=\x22badge\x20${l}\x22>${c}</span>`}async\x20function\x20loadNetworkInfo(){try{const\x20t=await\x20fetch(\x22/api/network-info\x22);if(!t.ok)throw\x20new\x20Error(`API\x20request\x20failed:\x20${t.status}`);const\x20e=await\x20t.json();updateDisplay(e)}catch(t){console.error(\x22Failed\x20to\x20load\x20network\x20info:\x22,t),updateDisplay({client:{},proxy:{}})}}document.getElementById(\x22refresh-ip-info\x22)?.addEventListener(\x22click\x22,function(){const\x20t=this;t.disabled=!0;const\x20e=t=>{[\x22host\x22,\x22ip\x22,\x22location\x22,\x22isp\x22,\x22proxy\x22].forEach(e=>{const\x20n=document.getElementById(`${t}-${e}`);n&&(n.innerHTML=\x27<span\x20class=\x22skeleton\x22></span>\x27)})};e(\x22proxy\x22),e(\x22client\x22),loadNetworkInfo().finally(()=>setTimeout(()=>{t.disabled=!1},500))}),document.addEventListener(\x22DOMContentLoaded\x22,loadNetworkInfo);';}